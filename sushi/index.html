<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Запечённые роллы в аэрогриле</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary-color: #ff6b6b;
            --secondary-color: #4ecdc4;
            --accent-color: #ffe66d;
            --cheese-color: #ffb347;
            --sauce-color: #ff8e53;
            --background-color: #f7fff7;
            --card-color: #ffffff;
            --text-color: #333333;
            --shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background-color: var(--background-color);
            color: var(--text-color);
            line-height: 1.6;
            padding: 20px;
            max-width: 1400px;
            margin: 0 auto;
            min-height: 100vh;
            background-image: 
                radial-gradient(circle at 10% 20%, rgba(255, 107, 107, 0.08) 0%, transparent 25%),
                radial-gradient(circle at 90% 80%, rgba(78, 205, 196, 0.08) 0%, transparent 25%),
                radial-gradient(circle at 50% 50%, rgba(255, 230, 109, 0.05) 0%, transparent 35%);
            animation: backgroundMove 20s infinite alternate ease-in-out;
        }
        
        @keyframes backgroundMove {
            0% { background-position: 0% 0%, 100% 100%, 50% 50%; }
            100% { background-position: 100% 100%, 0% 0%, 30% 70%; }
        }
        
        header {
            text-align: center;
            margin-bottom: 30px;
            padding: 30px;
            background: linear-gradient(135deg, var(--primary-color), #ff8e8e);
            border-radius: 20px;
            color: white;
            box-shadow: var(--shadow);
            position: relative;
            overflow: hidden;
            animation: headerSlide 1s ease-out;
        }
        
        @keyframes headerSlide {
            0% { transform: translateY(-30px); opacity: 0; }
            100% { transform: translateY(0); opacity: 1; }
        }
        
        .header-content {
            position: relative;
            z-index: 1;
        }
        
        h1 {
            font-size: 2.8rem;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.2);
            animation: textGlow 3s infinite alternate;
        }
        
        @keyframes textGlow {
            0% { text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.2); }
            100% { text-shadow: 0 0 15px rgba(255, 255, 255, 0.5), 2px 2px 4px rgba(0, 0, 0, 0.2); }
        }
        
        .subtitle {
            font-size: 1.3rem;
            opacity: 0.9;
            margin-bottom: 25px;
        }
        
        .controls-panel {
            display: flex;
            flex-wrap: wrap;
            gap: 30px;
            justify-content: center;
            margin: 20px 0;
            animation: fadeInUp 0.8s 0.2s both;
        }
        
        @keyframes fadeInUp {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .control-group {
            background: rgba(255, 255, 255, 0.2);
            padding: 20px;
            border-radius: 15px;
            backdrop-filter: blur(10px);
            min-width: 250px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            transition: transform 0.3s;
        }
        
        .control-group:hover {
            transform: translateY(-5px);
        }
        
        .control-group h3 {
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
            color: var(--accent-color);
        }
        
        .control-group h3 i {
            font-size: 1.2rem;
        }
        
        .slider-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 10px;
        }
        
        .slider-labels {
            display: flex;
            justify-content: space-between;
            width: 100%;
            font-size: 0.9rem;
            opacity: 0.8;
        }
        
        input[type="range"] {
            width: 100%;
            height: 12px;
            -webkit-appearance: none;
            background: rgba(255, 255, 255, 0.3);
            border-radius: 10px;
            outline: none;
        }
        
        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 28px;
            height: 28px;
            border-radius: 50%;
            background: var(--accent-color);
            cursor: pointer;
            box-shadow: 0 0 15px rgba(0, 0, 0, 0.3);
            transition: all 0.2s;
            border: 3px solid white;
        }
        
        input[type="range"]::-webkit-slider-thumb:hover {
            transform: scale(1.2);
            box-shadow: 0 0 20px rgba(255, 230, 109, 0.8);
        }
        
        .slider-value-display {
            font-size: 2.2rem;
            font-weight: bold;
            margin: 10px 0;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.2);
        }
        
        .options-container {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }
        
        .option-row {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 10px;
            border-radius: 10px;
            background: rgba(255, 255, 255, 0.1);
            transition: background 0.3s;
        }
        
        .option-row:hover {
            background: rgba(255, 255, 255, 0.2);
        }
        
        .option-row input[type="radio"], 
        .option-row input[type="checkbox"] {
            width: 20px;
            height: 20px;
            accent-color: var(--secondary-color);
        }
        
        .option-label {
            display: flex;
            flex-direction: column;
            flex-grow: 1;
        }
        
        .option-name {
            font-weight: bold;
            margin-bottom: 3px;
        }
        
        .option-price {
            font-size: 0.85rem;
            opacity: 0.8;
        }
        
        .hat-settings {
            margin-top: 15px;
            padding-top: 15px;
            border-top: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .hat-component {
            margin: 8px 0;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .hat-component input[type="checkbox"] {
            accent-color: var(--cheese-color);
        }
        
        .cost-summary {
            background: rgba(255, 255, 255, 0.2);
            padding: 20px;
            border-radius: 15px;
            backdrop-filter: blur(10px);
            min-width: 250px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            animation: fadeInUp 0.8s 0.4s both;
        }
        
        .cost-summary h3 {
            color: var(--accent-color);
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .cost-breakdown {
            margin-bottom: 15px;
        }
        
        .cost-row {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            border-bottom: 1px dashed rgba(255, 255, 255, 0.2);
        }
        
        .cost-row.total {
            border-top: 2px solid rgba(255, 255, 255, 0.3);
            border-bottom: none;
            font-weight: bold;
            font-size: 1.2rem;
            padding-top: 15px;
            margin-top: 10px;
        }
        
        .cost-amount {
            color: var(--accent-color);
            font-weight: bold;
        }
        
        .timer-container {
            display: flex;
            justify-content: center;
            align-items: center;
            margin: 20px 0;
            gap: 15px;
            flex-wrap: wrap;
            animation: fadeInUp 0.8s 0.6s both;
        }
        
        .timer-item {
            background-color: rgba(255, 255, 255, 0.2);
            color: white;
            padding: 18px 25px;
            border-radius: 15px;
            text-align: center;
            min-width: 160px;
            backdrop-filter: blur(10px);
            transition: transform 0.3s, box-shadow 0.3s;
            position: relative;
            overflow: hidden;
        }
        
        .timer-item:hover {
            transform: translateY(-8px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
        }
        
        .timer-item::before {
            content: "";
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.1), transparent);
            transition: left 0.7s;
        }
        
        .timer-item:hover::before {
            left: 100%;
        }
        
        .timer-value {
            font-size: 2.2rem;
            font-weight: bold;
        }
        
        .timer-label {
            font-size: 0.9rem;
            opacity: 0.9;
        }
        
        .container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-top: 30px;
        }
        
        @media (max-width: 1100px) {
            .container {
                grid-template-columns: 1fr;
            }
        }
        
        .card {
            background-color: var(--card-color);
            border-radius: 20px;
            padding: 30px;
            box-shadow: var(--shadow);
            transition: transform 0.4s, box-shadow 0.4s;
            animation: cardAppear 0.8s ease-out;
            animation-fill-mode: both;
            position: relative;
            overflow: hidden;
        }
        
        .card::before {
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 5px;
            background: linear-gradient(90deg, var(--primary-color), var(--secondary-color), var(--accent-color));
        }
        
        .card:nth-child(1) { animation-delay: 0.2s; }
        .card:nth-child(2) { animation-delay: 0.4s; }
        
        @keyframes cardAppear {
            0% { transform: translateY(30px) rotateX(10deg); opacity: 0; }
            100% { transform: translateY(0) rotateX(0); opacity: 1; }
        }
        
        .card:hover {
            transform: translateY(-10px) rotateX(2deg);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.15);
        }
        
        .card h2 {
            color: var(--primary-color);
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 3px solid var(--secondary-color);
            display: flex;
            align-items: center;
            position: relative;
        }
        
        .card h2 i {
            margin-right: 12px;
            font-size: 1.5rem;
        }
        
        .card h2::after {
            content: "";
            position: absolute;
            bottom: -3px;
            left: 0;
            width: 100px;
            height: 3px;
            background: linear-gradient(90deg, var(--primary-color), transparent);
        }
        
        .ingredients-list, .steps-list {
            list-style-type: none;
        }
        
        .ingredients-list li, .steps-list li {
            padding: 14px 0;
            border-bottom: 1px dashed #eee;
            display: flex;
            align-items: center;
            transition: all 0.3s;
            position: relative;
        }
        
        .ingredients-list li:hover, .steps-list li:hover {
            background-color: rgba(78, 205, 196, 0.05);
            border-radius: 8px;
            padding-left: 10px;
            padding-right: 10px;
            transform: translateX(5px);
        }
        
        .ingredients-list li:last-child, .steps-list li:last-child {
            border-bottom: none;
        }
        
        .ingredient-checkbox {
            margin-right: 15px;
            width: 22px;
            height: 22px;
            cursor: pointer;
            accent-color: var(--secondary-color);
            transition: transform 0.2s;
        }
        
        .ingredient-checkbox:hover {
            transform: scale(1.2);
        }
        
        .ingredient-amount {
            font-weight: bold;
            color: var(--primary-color);
            min-width: 100px;
            display: inline-block;
            transition: all 0.3s;
        }
        
        .ingredient-name {
            flex-grow: 1;
        }
        
        .ingredient-price {
            color: #666;
            font-size: 0.9rem;
            margin-left: 10px;
            opacity: 0.8;
            min-width: 80px;
            text-align: right;
        }
        
        .step-number {
            background-color: var(--primary-color);
            color: white;
            width: 36px;
            height: 36px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 15px;
            font-weight: bold;
            font-size: 1.1rem;
            flex-shrink: 0;
            box-shadow: 0 4px 8px rgba(255, 107, 107, 0.3);
            transition: transform 0.3s;
        }
        
        .steps-list li:hover .step-number {
            transform: rotate(15deg) scale(1.1);
        }
        
        .step-content {
            flex-grow: 1;
        }
        
        .ingredient-in-step {
            background-color: rgba(255, 107, 107, 0.1);
            border-left: 3px solid var(--primary-color);
            padding: 8px 12px;
            margin: 8px 0;
            border-radius: 0 8px 8px 0;
            font-size: 0.9rem;
        }
        
        .ingredient-in-step strong {
            color: var(--primary-color);
        }
        
        .step-timer {
            display: inline-flex;
            align-items: center;
            margin-left: 10px;
            color: var(--secondary-color);
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            gap: 5px;
            background-color: rgba(78, 205, 196, 0.1);
            padding: 5px 10px;
            border-radius: 20px;
            margin-top: 10px;
        }
        
        .step-timer:hover {
            color: var(--primary-color);
            transform: scale(1.1);
            background-color: rgba(255, 107, 107, 0.1);
        }
        
        .timer-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s;
            backdrop-filter: blur(5px);
        }
        
        .timer-modal.active {
            opacity: 1;
            visibility: visible;
        }
        
        .timer-modal-content {
            background-color: white;
            padding: 30px;
            border-radius: 20px;
            text-align: center;
            max-width: 400px;
            width: 90%;
            box-shadow: 0 20px 50px rgba(0, 0, 0, 0.3);
            transform: scale(0.7);
            transition: transform 0.4s;
            position: relative;
            overflow: hidden;
        }
        
        .timer-modal.active .timer-modal-content {
            transform: scale(1);
        }
        
        .timer-modal-content::before {
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 8px;
            background: linear-gradient(90deg, var(--primary-color), var(--secondary-color));
        }
        
        .timer-display {
            font-size: 4.5rem;
            font-weight: bold;
            color: var(--primary-color);
            margin: 20px 0;
            font-family: 'Courier New', monospace;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.1);
        }
        
        .timer-progress {
            width: 100%;
            height: 12px;
            background-color: #eee;
            border-radius: 6px;
            overflow: hidden;
            margin: 25px 0;
        }
        
        .timer-progress-bar {
            height: 100%;
            background: linear-gradient(90deg, var(--secondary-color), var(--primary-color));
            width: 100%;
            transform: scaleX(0);
            transform-origin: left;
            transition: transform 1s linear;
        }
        
        .timer-controls {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-top: 25px;
        }
        
        .timer-btn {
            padding: 12px 25px;
            border: none;
            border-radius: 50px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 1rem;
        }
        
        .timer-btn.start {
            background-color: var(--secondary-color);
            color: white;
        }
        
        .timer-btn.pause {
            background-color: var(--accent-color);
            color: #333;
        }
        
        .timer-btn.reset {
            background-color: #ddd;
            color: #333;
        }
        
        .timer-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 15px rgba(0, 0, 0, 0.15);
        }
        
        .close-timer {
            position: absolute;
            top: 15px;
            right: 15px;
            background: none;
            border: none;
            font-size: 1.8rem;
            cursor: pointer;
            color: #999;
            transition: color 0.3s;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
        }
        
        .close-timer:hover {
            color: var(--primary-color);
            background-color: #f5f5f5;
        }
        
        .note {
            background-color: rgba(255, 230, 109, 0.15);
            border-left: 5px solid var(--accent-color);
            padding: 20px;
            margin-top: 25px;
            border-radius: 0 10px 10px 0;
            animation: pulseGlow 4s infinite;
            position: relative;
            overflow: hidden;
        }
        
        @keyframes pulseGlow {
            0% { box-shadow: 0 0 0 0 rgba(255, 230, 109, 0.4); }
            70% { box-shadow: 0 0 0 15px rgba(255, 230, 109, 0); }
            100% { box-shadow: 0 0 0 0 rgba(255, 230, 109, 0); }
        }
        
        .aerogrill-img {
            width: 100%;
            height: 240px;
            background-color: #e0e0e0;
            border-radius: 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 25px 0;
            background-image: url('https://images.unsplash.com/photo-1579584425555-c3ce17fd4351?ixlib=rb-1.2.1&auto=format&fit=crop&w=800&q=80');
            background-size: cover;
            background-position: center;
            position: relative;
            overflow: hidden;
            box-shadow: inset 0 0 20px rgba(0, 0, 0, 0.2);
        }
        
        .aerogrill-img::before {
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(45deg, rgba(255, 107, 107, 0.4), rgba(78, 205, 196, 0.4));
            border-radius: 15px;
        }
        
        .aerogrill-img span {
            color: white;
            font-size: 2rem;
            font-weight: bold;
            z-index: 1;
            text-shadow: 2px 2px 8px rgba(0, 0, 0, 0.7);
            background: rgba(0, 0, 0, 0.6);
            padding: 15px 30px;
            border-radius: 15px;
            backdrop-filter: blur(5px);
            border: 2px solid rgba(255, 255, 255, 0.2);
        }
        
        .ingredient-category {
            margin-top: 25px;
            padding-top: 20px;
            border-top: 2px solid #eee;
            position: relative;
        }
        
        .ingredient-category h3 {
            color: var(--secondary-color);
            margin-bottom: 15px;
            font-size: 1.3rem;
            display: flex;
            align-items: center;
        }
        
        .ingredient-category h3 i {
            margin-right: 10px;
        }
        
        .progress-summary {
            margin-top: 25px;
            padding: 20px;
            background-color: rgba(78, 205, 196, 0.1);
            border-radius: 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border: 2px dashed rgba(78, 205, 196, 0.3);
        }
        
        .progress-text {
            font-weight: bold;
            display: flex;
            flex-direction: column;
        }
        
        .progress-count {
            font-size: 1.2rem;
            color: var(--primary-color);
        }
        
        .progress-bar-container {
            width: 60%;
        }
        
        .progress-bar {
            width: 100%;
            height: 12px;
            background-color: #ddd;
            border-radius: 6px;
            overflow: hidden;
            margin-bottom: 8px;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--secondary-color), var(--primary-color));
            width: 0%;
            transition: width 0.7s cubic-bezier(0.34, 1.56, 0.64, 1);
        }
        
        .reset-btn {
            display: block;
            margin: 25px auto 0;
            padding: 14px 30px;
            background-color: var(--primary-color);
            color: white;
            border: none;
            border-radius: 50px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 10px;
            justify-content: center;
        }
        
        .reset-btn:hover {
            background-color: #ff5252;
            transform: translateY(-3px);
            box-shadow: 0 10px 20px rgba(255, 107, 107, 0.3);
        }
        
        .roll-types {
            display: flex;
            flex-wrap: wrap;
            gap: 12px;
            margin: 20px 0;
        }
        
        .roll-type {
            background-color: var(--accent-color);
            padding: 10px 20px;
            border-radius: 50px;
            font-weight: bold;
            color: #333;
            transition: all 0.3s;
            position: relative;
            overflow: hidden;
        }
        
        .roll-type.cheese {
            background-color: var(--cheese-color);
            color: white;
        }
        
        .roll-type.sauce {
            background-color: var(--sauce-color);
            color: white;
        }
        
        .roll-type.combined {
            background: linear-gradient(45deg, var(--cheese-color), var(--sauce-color));
            color: white;
        }
        
        .roll-type::before {
            content: "";
            position: absolute;
            top: -100%;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(45deg, transparent, rgba(255, 255, 255, 0.3), transparent);
            transition: all 0.5s;
        }
        
        .roll-type:hover::before {
            top: 100%;
            left: 100%;
        }
        
        .roll-type:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 15px rgba(255, 230, 109, 0.4);
        }
        
        .roll-type.cheese:hover {
            box-shadow: 0 8px 15px rgba(255, 179, 71, 0.4);
        }
        
        .roll-type.sauce:hover {
            box-shadow: 0 8px 15px rgba(255, 142, 83, 0.4);
        }
        
        footer {
            text-align: center;
            margin-top: 50px;
            padding-top: 25px;
            border-top: 1px solid #ddd;
            color: #777;
            font-size: 0.9rem;
        }
        
        .print-btn {
            display: inline-block;
            background-color: var(--primary-color);
            color: white;
            padding: 16px 35px;
            border-radius: 50px;
            text-decoration: none;
            margin-top: 20px;
            font-weight: bold;
            transition: all 0.3s;
            border: none;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 10px;
            margin: 20px auto;
        }
        
        .print-btn:hover {
            background-color: #ff5252;
            transform: translateY(-3px);
            box-shadow: 0 10px 20px rgba(255, 107, 107, 0.3);
        }
        
        .completed {
            text-decoration: line-through;
            opacity: 0.6;
            transform: scale(0.98);
        }
        
        .completed .ingredient-amount, .completed .ingredient-price {
            color: #999;
        }
        
        .pulse {
            animation: pulseEffect 0.5s;
        }
        
        @keyframes pulseEffect {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }
        
        .floating-particles {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: -1;
        }
        
        .floating-particle {
            position: absolute;
            background: radial-gradient(circle, var(--secondary-color) 0%, transparent 70%);
            border-radius: 50%;
            opacity: 0.1;
            animation: floatParticle 15s infinite linear;
        }
        
        @keyframes floatParticle {
            0% { transform: translate(0, 0) rotate(0deg); }
            100% { transform: translate(100px, 100vh) rotate(360deg); }
        }
        
        .ingredient-highlight {
            background-color: rgba(255, 107, 107, 0.1);
            padding: 2px 6px;
            border-radius: 4px;
            border-left: 2px solid var(--primary-color);
            margin: 0 3px;
            font-weight: 600;
        }
        
        .ingredient-dynamic {
            background-color: rgba(78, 205, 196, 0.1);
            padding: 2px 6px;
            border-radius: 4px;
            border-left: 2px solid var(--secondary-color);
            margin: 0 3px;
            font-weight: 600;
        }
        
        .cheese-highlight {
            background-color: rgba(255, 179, 71, 0.2);
            padding: 2px 6px;
            border-radius: 4px;
            border-left: 2px solid var(--cheese-color);
            margin: 0 3px;
            font-weight: 600;
            color: #d35400;
        }
        
        .sauce-highlight {
            background-color: rgba(255, 142, 83, 0.2);
            padding: 2px 6px;
            border-radius: 4px;
            border-left: 2px solid var(--sauce-color);
            margin: 0 3px;
            font-weight: 600;
            color: #b33900;
        }
        
        .combined-highlight {
            background: linear-gradient(45deg, rgba(255, 179, 71, 0.2), rgba(255, 142, 83, 0.2));
            padding: 2px 6px;
            border-radius: 4px;
            border-left: 2px solid var(--cheese-color);
            margin: 0 3px;
            font-weight: 600;
        }
        
        .ingredient-tooltip {
            position: relative;
            cursor: help;
        }
        
        .ingredient-tooltip::after {
            content: attr(data-tooltip);
            position: absolute;
            bottom: 100%;
            left: 50%;
            transform: translateX(-50%);
            background: #333;
            color: white;
            padding: 5px 10px;
            border-radius: 5px;
            font-size: 0.8rem;
            white-space: nowrap;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s;
            z-index: 10;
        }
        
        .ingredient-tooltip:hover::after {
            opacity: 1;
            visibility: visible;
        }
        
        .hat-customization {
            margin-top: 10px;
            padding: 15px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
        }
        
        .hat-info {
            font-size: 0.85rem;
            opacity: 0.9;
            margin-top: 10px;
            padding: 10px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 5px;
        }
    </style>
</head>
<body>
    <!-- Плавающие частицы на фоне -->
    <div class="floating-particles" id="particles-container"></div>
    
    <header>
        <div class="header-content">
            <h1><i class="fas fa-fish"></i> Запечённые роллы в аэрогриле</h1>
            <p class="subtitle">Настройте рецепт под свои предпочтения и рассчитайте стоимость</p>
            
            <div class="controls-panel">
                <div class="control-group">
                    <h3><i class="fas fa-sliders-h"></i> Количество</h3>
                    <div class="slider-container">
                        <div class="slider-labels">
                            <span>4 кусочка</span>
                            <span>48 кусочков</span>
                        </div>
                        <input type="range" id="portion-slider" min="4" max="48" value="16" step="4">
                        <div class="slider-value-display" id="portion-value">16</div>
                        <div id="rolls-count">(4 ролла по 4 кусочка)</div>
                    </div>
                </div>
                
                <div class="control-group">
                    <h3><i class="fas fa-cogs"></i> Настройки рецепта</h3>
                    <div class="options-container">
                        <div class="option-row">
                            <input type="radio" id="filling-fish" name="filling" value="fish" checked>
                            <div class="option-label">
                                <span class="option-name">С рыбой (лосось/тунец)</span>
                                <span class="option-price">~300 руб/200г</span>
                            </div>
                        </div>
                        
                        <div class="option-row">
                            <input type="radio" id="filling-crab" name="filling" value="crab">
                            <div class="option-label">
                                <span class="option-name">С крабовыми палочками</span>
                                <span class="option-price">~150 руб/200г</span>
                            </div>
                        </div>
                        
                        <div class="option-row">
                            <input type="checkbox" id="tempura-option">
                            <div class="option-label">
                                <span class="option-name">С панировкой темпура</span>
                                <span class="option-price">+80 руб</span>
                            </div>
                        </div>
                        
                        <div class="hat-customization">
                            <h4 style="color: var(--accent-color); margin-bottom: 10px; display: flex; align-items: center; gap: 8px;">
                                <i class="fas fa-hat-chef"></i> Настройка шапочки
                            </h4>
                            <div class="hat-component">
                                <input type="checkbox" id="hat-mayo" checked>
                                <label for="hat-mayo">Майонез (основа шапочки)</label>
                            </div>
                            <div class="hat-component">
                                <input type="checkbox" id="hat-cheese" checked>
                                <label for="hat-cheese">Твёрдый сыр (для запекания)</label>
                            </div>
                            <div class="hat-component">
                                <input type="checkbox" id="hat-soy-sauce">
                                <label for="hat-soy-sauce">Соевый соус (для вкуса)</label>
                            </div>
                            <div class="hat-component">
                                <input type="checkbox" id="hat-garlic">
                                <label for="hat-garlic">Чеснок (для аромата)</label>
                            </div>
                            <div class="hat-component">
                                <input type="checkbox" id="hat-unagi">
                                <label for="hat-unagi">Соус унаги (по желанию)</label>
                            </div>
                            
                            <div class="hat-info">
                                <i class="fas fa-info-circle"></i> <strong>Классическая шапочка:</strong> майонез + твёрдый сыр. Дополнительные ингредиенты усиливают вкус.
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="cost-summary">
                    <h3><i class="fas fa-calculator"></i> Стоимость продуктов</h3>
                    <div class="cost-breakdown">
                        <div class="cost-row">
                            <span>Основные ингредиенты:</span>
                            <span class="cost-amount" id="cost-main">0 руб</span>
                        </div>
                        <div class="cost-row">
                            <span>Начинка:</span>
                            <span class="cost-amount" id="cost-filling">0 руб</span>
                        </div>
                        <div class="cost-row">
                            <span>Шапочка:</span>
                            <span class="cost-amount" id="cost-hat">0 руб</span>
                        </div>
                        <div class="cost-row">
                            <span>Дополнительно:</span>
                            <span class="cost-amount" id="cost-extra">0 руб</span>
                        </div>
                        <div class="cost-row total">
                            <span>Итого:</span>
                            <span class="cost-amount" id="cost-total">0 руб</span>
                        </div>
                    </div>
                    <div style="font-size: 0.85rem; opacity: 0.8; margin-top: 10px;">
                        <i class="fas fa-info-circle"></i> Цены примерные, могут меняться
                    </div>
                </div>
            </div>
            
            <div class="timer-container">
                <div class="timer-item">
                    <div class="timer-value">200°C</div>
                    <div class="timer-label">Температура аэрогриля</div>
                </div>
                <div class="timer-item">
                    <div class="timer-value" id="total-time">45-55 мин</div>
                    <div class="timer-label">Общее время</div>
                </div>
                <div class="timer-item">
                    <div class="timer-value" id="cost-per-piece">~0 руб</div>
                    <div class="timer-label">Цена за кусочек</div>
                </div>
            </div>
        </div>
    </header>
    
    <div class="container">
        <div class="card">
            <h2><i class="fas fa-shopping-cart"></i> Список покупок</h2>
            
            <div class="progress-summary">
                <div class="progress-text">
                    <span>Куплено:</span>
                    <span class="progress-count" id="bought-count">0</span>
                </div>
                <div class="progress-bar-container">
                    <div class="progress-bar">
                        <div class="progress-fill" id="progress-fill"></div>
                    </div>
                    <div style="font-size: 0.85rem; text-align: center;">
                        <span id="progress-percent">0%</span> готово
                    </div>
                </div>
            </div>
            
            <div class="ingredient-category">
                <h3><i class="fas fa-drumstick-bite"></i> Основные ингредиенты</h3>
                <ul class="ingredients-list" id="main-ingredients">
                    <!-- Будет заполнено JavaScript -->
                </ul>
            </div>
            
            <div class="ingredient-category">
                <h3><i class="fas fa-mortar-pestle"></i> Для заправки риса</h3>
                <ul class="ingredients-list" id="rice-ingredients">
                    <!-- Будет заполнено JavaScript -->
                </ul>
            </div>
            
            <div class="ingredient-category" id="hat-category">
                <h3><i class="fas fa-hat-chef"></i> Для шапочки</h3>
                <div id="hat-description" style="margin-bottom: 15px; font-size: 0.9rem; color: #666;">
                    Состав шапочки: майонез + твёрдый сыр
                </div>
                <ul class="ingredients-list" id="hat-ingredients">
                    <!-- Будет заполнено JavaScript -->
                </ul>
            </div>
            
            <div class="ingredient-category" id="tempura-category" style="display: none;">
                <h3><i class="fas fa-bread-slice"></i> Для темпуры</h3>
                <ul class="ingredients-list" id="tempura-ingredients">
                    <!-- Будет заполнено JavaScript -->
                </ul>
            </div>
            
            <button class="reset-btn" id="reset-list"><i class="fas fa-redo"></i> Сбросить список покупок</button>
            
            <div class="note">
                <p><i class="fas fa-lightbulb"></i> <strong>Совет:</strong> Для идеальных роллов используйте специальный рис для суши. Если нет рисового уксуса, смешайте 3 ст.л. обычного уксуса с 1 ст.л. сахара и ½ ч.л. соли.</p>
            </div>
        </div>
        
        <div class="card">
            <h2><i class="fas fa-utensils"></i> Пошаговая инструкция</h2>
            
            <div class="roll-types">
                <div class="roll-type"><i class="fas fa-fire"></i> Запечённые роллы</div>
                <div class="roll-type" id="filling-type"><i class="fas fa-fish"></i> С рыбой</div>
                <div class="roll-type" id="hat-type" class="combined"><i class="fas fa-hat-chef"></i> Шапочка: майонез+сыр</div>
                <div class="roll-type" id="tempura-badge" style="display: none;"><i class="fas fa-bread-slice"></i> В темпуре</div>
            </div>
            
            <ul class="steps-list" id="steps-list">
                <!-- Будет заполнено JavaScript -->
            </ul>
            
            <div class="aerogrill-img">
                <span id="aerogrill-text">Аэрогриль 200°C | 8-12 минут</span>
            </div>
            
            <div class="note">
                <p><i class="fas fa-clock"></i> <strong>Таймеры:</strong> Нажмите на значок таймера <i class="fas fa-hourglass-half"></i> рядом с шагом, чтобы запустить таймер для этого этапа приготовления.</p>
            </div>
        </div>
    </div>
    
    <!-- Модальное окно таймера -->
    <div class="timer-modal" id="timer-modal">
        <div class="timer-modal-content">
            <button class="close-timer" id="close-timer">&times;</button>
            <h2 id="timer-title">Таймер приготовления</h2>
            <div class="timer-display" id="timer-display">00:00</div>
            <div class="timer-progress">
                <div class="timer-progress-bar" id="timer-progress-bar"></div>
            </div>
            <div class="timer-controls">
                <button class="timer-btn start" id="start-timer"><i class="fas fa-play"></i> Старт</button>
                <button class="timer-btn pause" id="pause-timer"><i class="fas fa-pause"></i> Пауза</button>
                <button class="timer-btn reset" id="reset-timer"><i class="fas fa-stop"></i> Сброс</button>
            </div>
            <div style="margin-top: 20px; font-size: 0.9rem; color: #666;">
                Таймер будет пищать по окончании времени
            </div>
        </div>
    </div>
    
    <footer>
        <p>Рецепт специально для приготовления в аэрогриле при температуре 200°C</p>
        <p>Приятного аппетита! <i class="fas fa-utensil-spoon"></i></p>
        <button class="print-btn" onclick="window.print();"><i class="fas fa-print"></i> Распечатать рецепт</button>
    </footer>

    <script>
        // БАЗОВЫЕ ПРОПОРЦИИ (на 4 ролла = 16 кусочков)
        // Основано на проверенных рецептах запечённых роллов
        const baseProportions = {
            // На 16 кусочков (4 ролла)
            rice: 200, // г риса для суши
            water: 250, // мл воды для риса
            nori: 4, // листа нори
            fish: 200, // г рыбы
            crab: 200, // г крабовых палочек
            creamCheese: 150, // г сливочного сыра для начинки
            cucumber: 1, // шт огурца среднего
            avocado: 0.5, // шт авокадо (половинка на 4 ролла)
            
            // Для заправки риса (правильные пропорции)
            riceVinegar: 60, // мл рисового уксуса
            sugar: 40, // г сахара
            salt: 8, // г соли
            
            // Компоненты для шапочки (базовые)
            mayo: 120, // г майонеза (основа шапочки)
            hardCheese: 150, // г твёрдого сыра (пармезан, чеддер, российский)
            soySauce: 20, // мл соевого соуса (опционально)
            garlic: 2, // зубчика чеснока (опционально)
            unagiSauce: 30, // мл соуса унаги (опционально)
            
            // Для темпуры (на 16 кусочков)
            flour: 100, // г муки
            egg: 1, // шт яйца
            tempuraWater: 120, // мл ледяной воды
            bakingPowder: 5 // г разрыхлителя
        };

        // Цены на ингредиенты (руб, актуальные на 2024)
        const ingredientPrices = {
            rice: 120, // за 500г, ~24 руб/100г
            nori: 60, // за 10 листов, ~6 руб/лист
            fish: 400, // за 300г филе лосося, ~133 руб/100г
            crab: 180, // за 200г крабовых палочек, ~90 руб/100г
            creamCheese: 200, // за 200г, ~100 руб/100г
            cucumber: 40, // за 1 шт средний
            avocado: 120, // за 1 шт, ~60 руб/половинка
            
            // Для заправки риса
            riceVinegar: 150, // за 250мл, ~60 руб/100мл
            sugar: 60, // за 1кг, ~6 руб/100г
            salt: 30, // за 1кг, ~3 руб/100г
            
            // Для шапочки
            mayo: 80, // за 250г, ~32 руб/100г
            hardCheese: 300, // за 300г, ~100 руб/100г
            soySauce: 120, // за 250мл, ~48 руб/100мл
            garlic: 30, // за 100г, ~3 руб/зубчик
            unagiSauce: 200, // за 250мл, ~80 руб/100мл
            
            // Для темпуры
            flour: 50, // за 1кг, ~5 руб/100г
            egg: 120, // за 10 шт, ~12 руб/шт
            bakingPowder: 40 // за 100г, ~4 руб/10г
        };

        // Переменные состояния
        let currentPieces = 16;
        let currentFilling = "fish";
        let useTempura = false;
        let boughtIngredients = JSON.parse(localStorage.getItem('boughtIngredients')) || {};
        
        // Настройки шапочки
        let hatSettings = {
            mayo: true,
            cheese: true,
            soySauce: false,
            garlic: false,
            unagi: false
        };
        
        // Таймер
        let timerInterval = null;
        let timerSeconds = 0;
        let totalTimerSeconds = 0;
        let isTimerRunning = false;
        let currentStepIndex = 0;

        // DOM элементы
        const portionSlider = document.getElementById('portion-slider');
        const portionValue = document.getElementById('portion-value');
        const rollsCount = document.getElementById('rolls-count');
        const totalTime = document.getElementById('total-time');
        const costPerPiece = document.getElementById('cost-per-piece');
        
        const fillingFish = document.getElementById('filling-fish');
        const fillingCrab = document.getElementById('filling-crab');
        const tempuraOption = document.getElementById('tempura-option');
        
        // Элементы шапочки
        const hatMayo = document.getElementById('hat-mayo');
        const hatCheese = document.getElementById('hat-cheese');
        const hatSoySauce = document.getElementById('hat-soy-sauce');
        const hatGarlic = document.getElementById('hat-garlic');
        const hatUnagi = document.getElementById('hat-unagi');
        const hatDescription = document.getElementById('hat-description');
        
        const costMain = document.getElementById('cost-main');
        const costFilling = document.getElementById('cost-filling');
        const costHat = document.getElementById('cost-hat');
        const costExtra = document.getElementById('cost-extra');
        const costTotal = document.getElementById('cost-total');
        
        const mainIngredientsList = document.getElementById('main-ingredients');
        const riceIngredientsList = document.getElementById('rice-ingredients');
        const hatIngredientsList = document.getElementById('hat-ingredients');
        const tempuraCategory = document.getElementById('tempura-category');
        const tempuraIngredientsList = document.getElementById('tempura-ingredients');
        const stepsList = document.getElementById('steps-list');
        const boughtCount = document.getElementById('bought-count');
        const progressFill = document.getElementById('progress-fill');
        const progressPercent = document.getElementById('progress-percent');
        const resetListBtn = document.getElementById('reset-list');
        
        const fillingType = document.getElementById('filling-type');
        const hatType = document.getElementById('hat-type');
        const tempuraBadge = document.getElementById('tempura-badge');
        const aerogrillText = document.getElementById('aerogrill-text');

        // Инициализация
        document.addEventListener('DOMContentLoaded', function() {
            initControls();
            updateIngredients();
            renderSteps();
            updateProgress();
            updateCost();
            initTimerModal();
            createParticles();
            updateHatDescription();
            
            animateOnLoad();
        });

        // Инициализация элементов управления
        function initControls() {
            // Ползунок количества
            portionSlider.addEventListener('input', function() {
                currentPieces = parseInt(this.value);
                portionValue.textContent = currentPieces;
                
                const rolls = Math.ceil(currentPieces / 4);
                const piecesPerRoll = Math.ceil(currentPieces / rolls);
                rollsCount.textContent = `(${rolls} ${pluralize(rolls, 'ролл', 'ролла', 'роллов')} по ${piecesPerRoll} ${pluralize(piecesPerRoll, 'кусочек', 'кусочка', 'кусочков')})`;
                
                const baseTime = 45;
                const additionalTime = Math.max(0, currentPieces - 16) * 0.7;
                const minTime = Math.round(baseTime + additionalTime);
                const maxTime = Math.round(baseTime + additionalTime + 10);
                totalTime.textContent = `${minTime}-${maxTime} мин`;
                
                updateIngredients();
                renderSteps();
                updateCost();
                
                portionValue.classList.add('pulse');
                setTimeout(() => portionValue.classList.remove('pulse'), 500);
            });
            
            // Переключатель начинки
            fillingFish.addEventListener('change', function() {
                currentFilling = "fish";
                updateIngredients();
                renderSteps();
                updateCost();
                updateFillingDisplay();
            });
            
            fillingCrab.addEventListener('change', function() {
                currentFilling = "crab";
                updateIngredients();
                renderSteps();
                updateCost();
                updateFillingDisplay();
            });
            
            // Чекбокс темпуры
            tempuraOption.addEventListener('change', function() {
                useTempura = this.checked;
                tempuraCategory.style.display = useTempura ? 'block' : 'none';
                tempuraBadge.style.display = useTempura ? 'inline-flex' : 'none';
                
                updateIngredients();
                renderSteps();
                updateCost();
                updateProgress();
                
                if (useTempura) {
                    tempuraBadge.classList.add('pulse');
                    setTimeout(() => tempuraBadge.classList.remove('pulse'), 500);
                }
            });
            
            // Настройки шапочки
            hatMayo.addEventListener('change', updateHatSettings);
            hatCheese.addEventListener('change', updateHatSettings);
            hatSoySauce.addEventListener('change', updateHatSettings);
            hatGarlic.addEventListener('change', updateHatSettings);
            hatUnagi.addEventListener('change', updateHatSettings);
            
            // Блокировка выбора: если майонез отключен, нельзя выбрать соевый соус или унаги
            hatMayo.addEventListener('change', function() {
                if (!this.checked) {
                    hatSoySauce.checked = false;
                    hatUnagi.checked = false;
                    updateHatSettings();
                }
            });
        }
        
        function updateHatSettings() {
            hatSettings = {
                mayo: hatMayo.checked,
                cheese: hatCheese.checked,
                soySauce: hatSoySauce.checked,
                garlic: hatGarlic.checked,
                unagi: hatUnagi.checked
            };
            
            // Если майонез выключен, отключаем зависимые компоненты
            if (!hatSettings.mayo) {
                hatSettings.soySauce = false;
                hatSettings.unagi = false;
                hatSoySauce.checked = false;
                hatUnagi.checked = false;
            }
            
            updateIngredients();
            renderSteps();
            updateCost();
            updateHatDescription();
            updateHatDisplay();
        }
        
        function updateHatDescription() {
            const components = [];
            if (hatSettings.mayo) components.push("майонез");
            if (hatSettings.cheese) components.push("твёрдый сыр");
            if (hatSettings.soySauce) components.push("соевый соус");
            if (hatSettings.garlic) components.push("чеснок");
            if (hatSettings.unagi) components.push("соус унаги");
            
            let description = "Состав шапочки: ";
            if (components.length === 0) {
                description = "<i class='fas fa-exclamation-triangle'></i> Шапочка не выбрана!";
            } else if (components.length === 1) {
                description += components[0];
            } else {
                description += components.slice(0, -1).join(", ") + " и " + components[components.length - 1];
            }
            
            hatDescription.innerHTML = description;
            
            // Предупреждение если нет основы
            if (!hatSettings.mayo && !hatSettings.cheese) {
                hatDescription.innerHTML += "<br><small style='color: #ff6b6b;'>Рекомендуется добавить хотя бы один основной компонент</small>";
            }
        }
        
        function updateHatDisplay() {
            let hatName = "Шапочка: ";
            const components = [];
            
            if (hatSettings.mayo) components.push("майонез");
            if (hatSettings.cheese) components.push("сыр");
            if (hatSettings.soySauce) components.push("соус");
            if (hatSettings.garlic) components.push("чеснок");
            if (hatSettings.unagi) components.push("унаги");
            
            if (components.length === 0) {
                hatName = "Без шапочки";
                hatType.className = "roll-type";
            } else if (components.length === 1) {
                hatName += components[0];
                hatType.className = components[0] === "сыр" ? "roll-type cheese" : "roll-type sauce";
            } else if (hatSettings.mayo && hatSettings.cheese && components.length === 2) {
                hatName = "Шапочка: майонез+сыр";
                hatType.className = "roll-type combined";
            } else {
                hatName = "Комбинированная шапочка";
                hatType.className = "roll-type combined";
            }
            
            hatType.innerHTML = `<i class="fas fa-hat-chef"></i> ${hatName}`;
            
            // Обновляем время запекания
            let bakingTime = "8-12 минут";
            if (hatSettings.cheese) {
                bakingTime = "10-15 минут"; // Сыр требует больше времени
            }
            aerogrillText.textContent = `Аэрогриль 200°C | ${bakingTime}`;
            
            // Анимация
            hatType.classList.add('pulse');
            setTimeout(() => hatType.classList.remove('pulse'), 500);
        }

        function updateFillingDisplay() {
            const icon = currentFilling === 'fish' ? '<i class="fas fa-fish"></i>' : '<i class="fas fa-crab"></i>';
            const text = currentFilling === 'fish' ? 'С рыбой' : 'С крабовыми палочками';
            fillingType.innerHTML = `${icon} ${text}`;
            
            fillingType.classList.add('pulse');
            setTimeout(() => fillingType.classList.remove('pulse'), 500);
        }

        // Расчет количества ингредиента
        function calculateAmount(baseAmount, pieces) {
            return (baseAmount / 16) * pieces;
        }

        // Форматирование количества
        function formatAmount(amount, unit) {
            if (unit === 'шт.' || unit === 'зубчик') {
                if (amount < 0.25) return `${(amount * 4).toFixed(1)}/${unit}`;
                return amount % 1 === 0 ? `${amount} ${unit}` : `${amount.toFixed(1)} ${unit}`;
            } else if (unit === 'ст.л.' || unit === 'ч.л.') {
                if (amount < 0.5) return `${(amount * 5).toFixed(1)} мл`;
                return `${amount.toFixed(1)} ${unit}`;
            } else {
                if (amount < 10) return `${amount.toFixed(1)} ${unit}`;
                return `${Math.round(amount)} ${unit}`;
            }
        }

        // Обновление списка ингредиентов
        function updateIngredients() {
            mainIngredientsList.innerHTML = '';
            riceIngredientsList.innerHTML = '';
            hatIngredientsList.innerHTML = '';
            tempuraIngredientsList.innerHTML = '';
            
            // Основные ингредиенты
            const mainIngredients = [
                { 
                    id: "rice", 
                    name: "Рис для суши (круглозерный)", 
                    unit: "г", 
                    baseAmount: baseProportions.rice, 
                    priceKey: "rice",
                    tooltip: "Специальный рис для суши, хорошо держит форму"
                },
                { 
                    id: "nori", 
                    name: "Нори (листы для суши)", 
                    unit: "шт.", 
                    baseAmount: baseProportions.nori, 
                    priceKey: "nori",
                    tooltip: "Тонкие листы из водорослей"
                },
                { 
                    id: "filling", 
                    name: currentFilling === 'fish' ? "Филе лосося/тунца" : "Крабовые палочки", 
                    unit: "г", 
                    baseAmount: currentFilling === 'fish' ? baseProportions.fish : baseProportions.crab, 
                    priceKey: currentFilling,
                    tooltip: currentFilling === 'fish' ? "Свежее филе, можно замороженное" : "Имитация крабового мяса"
                },
                { 
                    id: "creamCheese", 
                    name: "Сливочный сыр (Филадельфия)", 
                    unit: "г", 
                    baseAmount: baseProportions.creamCheese, 
                    priceKey: "creamCheese",
                    tooltip: "Для начинки роллов"
                },
                { 
                    id: "cucumber", 
                    name: "Огурец", 
                    unit: "шт.", 
                    baseAmount: baseProportions.cucumber, 
                    priceKey: "cucumber",
                    tooltip: "Среднего размера, очистить от семян"
                },
                { 
                    id: "avocado", 
                    name: "Авокадо", 
                    unit: "шт.", 
                    baseAmount: baseProportions.avocado, 
                    priceKey: "avocado",
                    tooltip: "Спелый, но не перезрелый"
                }
            ];
            
            // Для заправки риса
            const riceIngredients = [
                { 
                    id: "riceVinegar", 
                    name: "Рисовый уксус", 
                    unit: "мл", 
                    baseAmount: baseProportions.riceVinegar, 
                    priceKey: "riceVinegar",
                    tooltip: "Можно заменить смесью из обычного уксуса, сахара и соли"
                },
                { 
                    id: "sugar", 
                    name: "Сахар", 
                    unit: "г", 
                    baseAmount: baseProportions.sugar, 
                    priceKey: "sugar",
                    tooltip: "Для заправки риса"
                },
                { 
                    id: "salt", 
                    name: "Соль", 
                    unit: "г", 
                    baseAmount: baseProportions.salt, 
                    priceKey: "salt",
                    tooltip: "Морская или обычная поваренная"
                }
            ];
            
            // Для шапочки
            const hatIngredients = [];
            if (hatSettings.mayo) {
                hatIngredients.push({ 
                    id: "mayo", 
                    name: "Майонез", 
                    unit: "г", 
                    baseAmount: baseProportions.mayo, 
                    priceKey: "mayo",
                    tooltip: "Основа шапочки, лучше использовать с высоким % жирности"
                });
            }
            if (hatSettings.cheese) {
                hatIngredients.push({ 
                    id: "hardCheese", 
                    name: "Твёрдый сыр (для запекания)", 
                    unit: "г", 
                    baseAmount: baseProportions.hardCheese, 
                    priceKey: "hardCheese",
                    tooltip: "Пармезан, чеддер, российский или любой твёрдый сыр"
                });
            }
            if (hatSettings.soySauce) {
                hatIngredients.push({ 
                    id: "soySauce", 
                    name: "Соевый соус", 
                    unit: "мл", 
                    baseAmount: baseProportions.soySauce, 
                    priceKey: "soySauce",
                    tooltip: "Для вкуса, лучше светлый соевый соус"
                });
            }
            if (hatSettings.garlic) {
                hatIngredients.push({ 
                    id: "garlic", 
                    name: "Чеснок", 
                    unit: "зубчик", 
                    baseAmount: baseProportions.garlic, 
                    priceKey: "garlic",
                    tooltip: "Свежий, мелко порубить или пропустить через пресс"
                });
            }
            if (hatSettings.unagi) {
                hatIngredients.push({ 
                    id: "unagiSauce", 
                    name: "Соус унаги", 
                    unit: "мл", 
                    baseAmount: baseProportions.unagiSauce, 
                    priceKey: "unagiSauce",
                    tooltip: "Сладкий соус для суши, можно заменить терияки"
                });
            }
            
            // Для темпуры
            const tempuraIngredients = [
                { 
                    id: "flour", 
                    name: "Мука пшеничная", 
                    unit: "г", 
                    baseAmount: baseProportions.flour, 
                    priceKey: "flour",
                    tooltip: "Лучше использовать муку для выпечки"
                },
                { 
                    id: "egg", 
                    name: "Яйцо", 
                    unit: "шт.", 
                    baseAmount: baseProportions.egg, 
                    priceKey: "egg",
                    tooltip: "Крупное, комнатной температуры"
                },
                { 
                    id: "tempuraWater", 
                    name: "Ледяная вода", 
                    unit: "мл", 
                    baseAmount: baseProportions.tempuraWater, 
                    priceKey: null,
                    tooltip: "Очень холодная вода для хрустящей корочки"
                },
                { 
                    id: "bakingPowder", 
                    name: "Разрыхлитель", 
                    unit: "г", 
                    baseAmount: baseProportions.bakingPowder, 
                    priceKey: "bakingPowder",
                    tooltip: "Для воздушности кляра"
                }
            ];
            
            renderIngredientList(mainIngredientsList, mainIngredients);
            renderIngredientList(riceIngredientsList, riceIngredients);
            renderIngredientList(hatIngredientsList, hatIngredients);
            
            if (useTempura) {
                renderIngredientList(tempuraIngredientsList, tempuraIngredients);
            }
            
            updateTotalIngredientsCount(mainIngredients.length + riceIngredients.length + hatIngredients.length + (useTempura ? tempuraIngredients.length : 0));
        }

        // Рендеринг списка ингредиентов
        function renderIngredientList(container, ingredientList) {
            ingredientList.forEach(ingredient => {
                const calculatedAmount = calculateAmount(ingredient.baseAmount, currentPieces);
                const displayAmount = formatAmount(calculatedAmount, ingredient.unit);
                
                let price = 0;
                if (ingredient.priceKey) {
                    price = (ingredientPrices[ingredient.priceKey] / ingredient.baseAmount) * calculatedAmount;
                }
                
                const isChecked = boughtIngredients[ingredient.id] || false;
                
                const li = document.createElement('li');
                li.className = isChecked ? 'completed' : '';
                li.dataset.id = ingredient.id;
                
                li.innerHTML = `
                    <input type="checkbox" class="ingredient-checkbox" id="${ingredient.id}" ${isChecked ? 'checked' : ''}>
                    <span class="ingredient-amount">${displayAmount}</span>
                    <span class="ingredient-name ${ingredient.tooltip ? 'ingredient-tooltip' : ''}" ${ingredient.tooltip ? `data-tooltip="${ingredient.tooltip}"` : ''}>${ingredient.name}</span>
                    ${price > 0 ? `<span class="ingredient-price">~${Math.round(price)} руб</span>` : '<span class="ingredient-price"></span>'}
                `;
                
                const checkbox = li.querySelector('.ingredient-checkbox');
                checkbox.addEventListener('change', function() {
                    boughtIngredients[ingredient.id] = this.checked;
                    localStorage.setItem('boughtIngredients', JSON.stringify(boughtIngredients));
                    li.classList.toggle('completed', this.checked);
                    updateProgress();
                    
                    li.classList.add('pulse');
                    setTimeout(() => li.classList.remove('pulse'), 300);
                });
                
                container.appendChild(li);
            });
        }

        // Обновление общего количества ингредиентов
        function updateTotalIngredientsCount(total) {
            const bought = Object.keys(boughtIngredients).filter(key => boughtIngredients[key]).length;
            const percentage = total > 0 ? (bought / total) * 100 : 0;
            
            boughtCount.textContent = bought;
            progressFill.style.width = `${percentage}%`;
            progressPercent.textContent = `${Math.round(percentage)}%`;
        }

        // Рендеринг шагов приготовления
        function renderSteps() {
            stepsList.innerHTML = '';
            
            // Расчет текущих количеств
            const riceAmount = calculateAmount(baseProportions.rice, currentPieces);
            const waterAmount = calculateAmount(baseProportions.water, currentPieces);
            const vinegarAmount = calculateAmount(baseProportions.riceVinegar, currentPieces);
            const sugarAmount = calculateAmount(baseProportions.sugar, currentPieces);
            const saltAmount = calculateAmount(baseProportions.salt, currentPieces);
            
            const fillingAmount = calculateAmount(currentFilling === 'fish' ? baseProportions.fish : baseProportions.crab, currentPieces);
            const cheeseAmount = calculateAmount(baseProportions.creamCheese, currentPieces);
            const cucumberAmount = calculateAmount(baseProportions.cucumber, currentPieces);
            const avocadoAmount = calculateAmount(baseProportions.avocado, currentPieces);
            const noriAmount = calculateAmount(baseProportions.nori, currentPieces);
            
            const rolls = Math.ceil(currentPieces / 4);
            
            const fillingName = currentFilling === 'fish' ? 'лосось/тунец' : 'крабовые палочки';
            const fillingDisplayName = currentFilling === 'fish' ? 'Лосось/тунец' : 'Крабовые палочки';
            
            // Шаг 1: Приготовление риса
            addStep(1, `
                <strong>Приготовьте рис для суши:</strong> Промойте <span class="ingredient-highlight">${formatAmount(riceAmount, 'г')} риса</span> 
                5-7 раз до прозрачной воды. Залейте <span class="ingredient-highlight">${formatAmount(waterAmount, 'мл')} холодной воды</span>.
                <div class="ingredient-in-step">
                    <strong>Для заправки смешайте:</strong><br>
                    • <span class="ingredient-highlight">${formatAmount(vinegarAmount, 'мл')} рисового уксуса</span><br>
                    • <span class="ingredient-highlight">${formatAmount(sugarAmount, 'г')} сахара</span><br>
                    • <span class="ingredient-highlight">${formatAmount(saltAmount, 'г')} соли</span><br>
                    • Нагрейте до растворения сахара и соли
                </div>
                Сварите рис (обычно 15 минут после закипания). В тёплый рис добавьте заправку, аккуратно перемешайте и остудите.
            `, true, 20, "Приготовление риса");
            
            // Шаг 2: Подготовка начинки
            addStep(2, `
                <strong>Подготовьте начинку:</strong>
                <div class="ingredient-in-step">
                    <strong>Нарежьте соломкой:</strong><br>
                    • <span class="ingredient-dynamic">${formatAmount(fillingAmount, 'г')} ${fillingDisplayName}</span><br>
                    • <span class="ingredient-highlight">${formatAmount(cucumberAmount, 'шт')} огурца</span> (очистить от кожуры и семян)<br>
                    • <span class="ingredient-highlight">${formatAmount(avocadoAmount, 'шт')} авокадо</span><br>
                    • <span class="ingredient-highlight">${formatAmount(cheeseAmount, 'г')} сливочного сыра</span> (нарезать полосками)
                </div>
                Длина нарезки должна быть немного меньше ширины листа нори.
            `, true, 10, "Подготовка начинки");
            
            // Шаг 3: Приготовление шапочки
            const hasHatComponents = hatSettings.mayo || hatSettings.cheese || hatSettings.soySauce || hatSettings.garlic || hatSettings.unagi;
            
            if (hasHatComponents) {
                let hatIngredientsHTML = '';
                let hatInstructions = '';
                
                if (hatSettings.mayo && hatSettings.cheese) {
                    const mayoAmount = calculateAmount(baseProportions.mayo, currentPieces);
                    const cheeseAmount = calculateAmount(baseProportions.hardCheese, currentPieces);
                    
                    hatIngredientsHTML += `
                        • <span class="combined-highlight">${formatAmount(mayoAmount, 'г')} майонеза</span><br>
                        • <span class="combined-highlight">${formatAmount(cheeseAmount, 'г')} твёрдого сыра</span> (натереть на мелкой тёрке)<br>
                    `;
                    hatInstructions = "Натрите сыр на мелкой тёрке и смешайте с майонезом до однородной консистенции.";
                } else if (hatSettings.mayo) {
                    const mayoAmount = calculateAmount(baseProportions.mayo, currentPieces);
                    hatIngredientsHTML += `<span class="sauce-highlight">${formatAmount(mayoAmount, 'г')} майонеза</span>`;
                    hatInstructions = "Используйте майонез как основу для шапочки.";
                } else if (hatSettings.cheese) {
                    const cheeseAmount = calculateAmount(baseProportions.hardCheese, currentPieces);
                    hatIngredientsHTML += `<span class="cheese-highlight">${formatAmount(cheeseAmount, 'г')} твёрдого сыра</span> (натереть на мелкой тёрке)`;
                    hatInstructions = "Натрите сыр и смешайте с небольшим количеством майонеза для вязкости.";
                }
                
                if (hatSettings.soySauce) {
                    const soyAmount = calculateAmount(baseProportions.soySauce, currentPieces);
                    hatIngredientsHTML += `<br>• <span class="sauce-highlight">${formatAmount(soyAmount, 'мл')} соевого соуса</span>`;
                    hatInstructions += " Добавьте соевый соус для солёного вкуса.";
                }
                
                if (hatSettings.garlic) {
                    const garlicAmount = calculateAmount(baseProportions.garlic, currentPieces);
                    hatIngredientsHTML += `<br>• <span class="sauce-highlight">${formatAmount(garlicAmount, 'зубчик')} чеснока</span> (мелко порубить)`;
                    hatInstructions += " Добавьте чеснок для аромата.";
                }
                
                if (hatSettings.unagi) {
                    const unagiAmount = calculateAmount(baseProportions.unagiSauce, currentPieces);
                    hatIngredientsHTML += `<br>• <span class="sauce-highlight">${formatAmount(unagiAmount, 'мл')} соуса унаги</span>`;
                    hatInstructions += " Добавьте соус унаги для сладковатого вкуса.";
                }
                
                addStep(3, `
                    <strong>Приготовьте шапочку для запекания:</strong>
                    <div class="ingredient-in-step">
                        <strong>Смешайте:</strong><br>
                        ${hatIngredientsHTML}
                    </div>
                    ${hatInstructions} Масса должна быть достаточно густой, чтобы не стекать с роллов.
                `, false);
            }
            
            // Шаг 4: Сборка роллов
            addStep(4, `
                <strong>Соберите роллы:</strong> Положите на бамбуковый коврик 
                <span class="ingredient-highlight">${formatAmount(noriAmount, 'шт')} листа нори</span> блестящей стороной вниз.
                <div class="ingredient-in-step">
                    <strong>Равномерно распределите рис:</strong><br>
                    • Слой риса толщиной 0,7-1 см<br>
                    • Оставьте 2 см свободного края сверху<br>
                    • Смочите свободный край водой
                </div>
                Рис должен быть комнатной температуры.
            `, false);
            
            // Шаг 5: Добавление начинки
            addStep(5, `
                <strong>Добавьте начинку:</strong>
                <div class="ingredient-in-step">
                    <strong>Посередине риса выложите полосками:</strong><br>
                    • Сливочный сыр<br>
                    • ${fillingDisplayName}<br>
                    • Огурец и авокадо
                </div>
                Не перегружайте роллы начинкой, иначе будет сложно свернуть.
            `, false);
            
            // Шаг 6: Свертывание роллов
            addStep(6, `
                <strong>Сверните роллы:</strong> Поднимите край коврика и аккуратно сверните ролл.
                <div class="ingredient-in-step">
                    <strong>Техника:</strong><br>
                    • Прижмите начинку пальцами<br>
                    • Сверните плотно, но не слишком туго<br>
                    • Прокрутите ролл для формы цилиндра<br>
                    • Должно получиться ${rolls} плотных ролла
                </div>
                Свободный край нори смажьте водой для склеивания.
            `, false);
            
            // Шаг 7: Нарезка роллов
            const piecesPerRoll = Math.ceil(currentPieces / rolls);
            addStep(7, `
                <strong>Нарежьте роллы:</strong> Острым влажным ножом нарежьте каждый ролл на 
                <span class="ingredient-highlight">${piecesPerRoll} ${pluralize(piecesPerRoll, 'кусочек', 'кусочка', 'кусочков')}</span>.
                <div class="ingredient-in-step">
                    <strong>Советы:</strong><br>
                    • Смачивайте нож водой после каждого разреза<br>
                    • Используйте пилящие движения без нажима<br>
                    • Первый и последний кусочки могут быть неидеальными<br>
                    • Всего должно получиться ${currentPieces} кусочков
                </div>
            `, false);
            
            // Шаг 8: Нанесение шапочки
            if (hasHatComponents) {
                addStep(8, `
                    <strong>Нанесите шапочку:</strong> Выложите кусочки роллов на решётку аэрогриля.
                    <div class="ingredient-in-step">
                        <strong>Распределите шапочку:</strong><br>
                        • Нанесите шапочку ложкой или кондитерским мешком<br>
                        • Распределите равномерно по поверхности<br>
                        • Можно сделать узоры или просто покрыть полностью
                    </div>
                    Если шапочка с сыром, можно сверху посыпать ещё немного сыра.
                `, false);
            }
            
            // Дополнительные шаги для темпуры
            let stepNumber = hasHatComponents ? 9 : 8;
            
            if (useTempura) {
                const flourAmount = calculateAmount(baseProportions.flour, currentPieces);
                const eggAmount = calculateAmount(baseProportions.egg, currentPieces);
                const tempuraWaterAmount = calculateAmount(baseProportions.tempuraWater, currentPieces);
                const bakingPowderAmount = calculateAmount(baseProportions.bakingPowder, currentPieces);
                
                // Шаг для темпуры (перед нанесением шапочки или вместо)
                const tempuraStep = hasHatComponents ? 8 : 7;
                
                addStep(tempuraStep, `
                    <strong>Приготовьте кляр темпура:</strong>
                    <div class="ingredient-in-step">
                        <strong>Смешайте в миске:</strong><br>
                        • <span class="ingredient-highlight">${formatAmount(flourAmount, 'г')} муки</span><br>
                        • <span class="ingredient-highlight">${formatAmount(bakingPowderAmount, 'г')} разрыхлителя</span><br>
                        • <span class="ingredient-highlight">${formatAmount(eggAmount, 'шт')} яйца</span><br>
                        • Постепенно вливайте <span class="ingredient-highlight">${formatAmount(tempuraWaterAmount, 'мл')} ледяной воды</span>
                    </div>
                    Перемешивайте быстро и недолго - в кляре должны оставаться комочки.
                `, false);
                
                addStep(tempuraStep + 1, `
                    <strong>Обмакните роллы в кляр:</strong> Обмакните каждый кусочек в кляр.
                    <div class="ingredient-in-step">
                        <strong>Советы:</strong><br>
                        • Кляр должен покрывать ролл со всех сторон<br>
                        • Дайте лишнему кляру стечь<br>
                        • Уложите на решётку аэрогриля
                    </div>
                    ${hasHatComponents ? 'Затем нанесите шапочку поверх кляра.' : ''}
                `, false);
                
                stepNumber = tempuraStep + (hasHatComponents ? 2 : 2);
            }
            
            // Финальный шаг: Запекание
            const bakingTime = hatSettings.cheese ? "10-15 минут" : "8-12 минут";
            const hatTypeText = hatSettings.cheese ? "Сырная шапочка расплавится и покроется золотистой корочкой." : "Шапочка зарумянится.";
            
            addStep(stepNumber, `
                <strong>Запекайте в аэрогриле:</strong>
                <div class="ingredient-in-step">
                    <strong>Настройки аэрогриля:</strong><br>
                    • Температура: <span class="ingredient-highlight">200°C</span><br>
                    • Время: <span class="ingredient-highlight">${bakingTime}</span><br>
                    • Режим: конвекция (если есть)<br>
                    • До золотистой корочки
                </div>
                ${hatTypeText} ${useTempura ? 'Кляр темпура станет хрустящим.' : ''}
                Подавайте горячими, украсив кунжутом, зелёным луком и соусом.
            `, true, hatSettings.cheese ? 15 : 12, "Запекание роллов");
        }

        // Добавление шага в список
        function addStep(number, text, hasTimer, timerMinutes, timerName) {
            const li = document.createElement('li');
            li.innerHTML = `
                <div class="step-number">${number}</div>
                <div class="step-content">
                    ${text}
                    ${hasTimer ? `<span class="step-timer" data-index="${number-1}"><i class="fas fa-hourglass-half"></i> Таймер: ${timerMinutes} мин</span>` : ''}
                `;
            
            if (hasTimer) {
                const timerBtn = li.querySelector('.step-timer');
                timerBtn.addEventListener('click', function() {
                    currentStepIndex = parseInt(this.getAttribute('data-index'));
                    openTimerModal(timerName, timerMinutes * 60);
                });
            }
            
            stepsList.appendChild(li);
        }

        // Обновление стоимости
        function updateCost() {
            // Основные ингредиенты (кроме начинки)
            const riceAmount = calculateAmount(baseProportions.rice, currentPieces);
            const noriAmount = calculateAmount(baseProportions.nori, currentPieces);
            const creamCheeseAmount = calculateAmount(baseProportions.creamCheese, currentPieces);
            const cucumberAmount = calculateAmount(baseProportions.cucumber, currentPieces);
            const avocadoAmount = calculateAmount(baseProportions.avocado, currentPieces);
            
            const mainCost = 
                (ingredientPrices.rice / baseProportions.rice) * riceAmount +
                (ingredientPrices.nori / baseProportions.nori) * noriAmount +
                (ingredientPrices.creamCheese / baseProportions.creamCheese) * creamCheeseAmount +
                (ingredientPrices.cucumber / baseProportions.cucumber) * cucumberAmount +
                (ingredientPrices.avocado / baseProportions.avocado) * avocadoAmount;
            
            // Начинка
            const fillingAmount = calculateAmount(currentFilling === 'fish' ? baseProportions.fish : baseProportions.crab, currentPieces);
            const fillingPrice = currentFilling === 'fish' ? ingredientPrices.fish : ingredientPrices.crab;
            const fillingBaseAmount = currentFilling === 'fish' ? baseProportions.fish : baseProportions.crab;
            const fillingCost = (fillingPrice / fillingBaseAmount) * fillingAmount;
            
            // Заправка риса
            const riceVinegarAmount = calculateAmount(baseProportions.riceVinegar, currentPieces);
            const sugarAmount = calculateAmount(baseProportions.sugar, currentPieces);
            const saltAmount = calculateAmount(baseProportions.salt, currentPieces);
            
            const riceDressingCost = 
                (ingredientPrices.riceVinegar / baseProportions.riceVinegar) * riceVinegarAmount +
                (ingredientPrices.sugar / baseProportions.sugar) * sugarAmount +
                (ingredientPrices.salt / baseProportions.salt) * saltAmount;
            
            // Шапочка
            let hatCost = 0;
            if (hatSettings.mayo) {
                const mayoAmount = calculateAmount(baseProportions.mayo, currentPieces);
                hatCost += (ingredientPrices.mayo / baseProportions.mayo) * mayoAmount;
            }
            if (hatSettings.cheese) {
                const cheeseAmount = calculateAmount(baseProportions.hardCheese, currentPieces);
                hatCost += (ingredientPrices.hardCheese / baseProportions.hardCheese) * cheeseAmount;
            }
            if (hatSettings.soySauce) {
                const soyAmount = calculateAmount(baseProportions.soySauce, currentPieces);
                hatCost += (ingredientPrices.soySauce / baseProportions.soySauce) * soyAmount;
            }
            if (hatSettings.garlic) {
                const garlicAmount = calculateAmount(baseProportions.garlic, currentPieces);
                hatCost += (ingredientPrices.garlic / baseProportions.garlic) * garlicAmount;
            }
            if (hatSettings.unagi) {
                const unagiAmount = calculateAmount(baseProportions.unagiSauce, currentPieces);
                hatCost += (ingredientPrices.unagiSauce / baseProportions.unagiSauce) * unagiAmount;
            }
            
            // Темпура
            let tempuraCost = 0;
            if (useTempura) {
                const flourAmount = calculateAmount(baseProportions.flour, currentPieces);
                const eggAmount = calculateAmount(baseProportions.egg, currentPieces);
                const bakingPowderAmount = calculateAmount(baseProportions.bakingPowder, currentPieces);
                
                tempuraCost = 
                    (ingredientPrices.flour / baseProportions.flour) * flourAmount +
                    (ingredientPrices.egg / baseProportions.egg) * eggAmount +
                    (ingredientPrices.bakingPowder / baseProportions.bakingPowder) * bakingPowderAmount;
            }
            
            // Итоговые стоимости
            const totalMainCost = mainCost + riceDressingCost;
            const totalCost = totalMainCost + fillingCost + hatCost + tempuraCost;
            const costPerPieceValue = totalCost / currentPieces;
            
            costMain.textContent = `${Math.round(totalMainCost)} руб`;
            costFilling.textContent = `${Math.round(fillingCost)} руб`;
            costHat.textContent = `${Math.round(hatCost)} руб`;
            costExtra.textContent = `${Math.round(tempuraCost)} руб`;
            costTotal.textContent = `${Math.round(totalCost)} руб`;
            costPerPiece.textContent = `~${Math.round(costPerPieceValue)} руб`;
        }

        // Обновление прогресса покупок
        function updateProgress() {
            const totalIngredients = document.querySelectorAll('.ingredients-list li').length;
            const bought = document.querySelectorAll('.ingredient-checkbox:checked').length;
            const percentage = totalIngredients > 0 ? (bought / totalIngredients) * 100 : 0;
            
            boughtCount.textContent = bought;
            progressFill.style.width = `${percentage}%`;
            progressPercent.textContent = `${Math.round(percentage)}%`;
            
            progressFill.style.transition = 'width 0.7s cubic-bezier(0.34, 1.56, 0.64, 1)';
        }

        // Сброс списка покупок
        resetListBtn.addEventListener('click', function() {
            if (confirm('Вы уверены, что хотите сбросить список покупок?')) {
                boughtIngredients = {};
                localStorage.removeItem('boughtIngredients');
                
                document.querySelectorAll('.ingredient-checkbox').forEach(checkbox => {
                    checkbox.checked = false;
                });
                
                document.querySelectorAll('.ingredients-list li').forEach(li => {
                    li.classList.remove('completed');
                });
                
                updateProgress();
                
                this.innerHTML = '<i class="fas fa-check"></i> Сброшено!';
                this.style.backgroundColor = '#4CAF50';
                setTimeout(() => {
                    this.innerHTML = '<i class="fas fa-redo"></i> Сбросить список покупок';
                    this.style.backgroundColor = '';
                }, 1500);
            }
        });

        // Таймер
        function initTimerModal() {
            closeTimerBtn.addEventListener('click', closeTimerModal);
            timerModal.addEventListener('click', function(e) {
                if (e.target === timerModal) {
                    closeTimerModal();
                }
            });
            
            startTimerBtn.addEventListener('click', startTimer);
            pauseTimerBtn.addEventListener('click', pauseTimer);
            resetTimerBtn.addEventListener('click', resetTimer);
        }

        function openTimerModal(title, seconds) {
            timerTitle.textContent = title;
            totalTimerSeconds = seconds;
            resetTimer();
            
            timerModal.classList.add('active');
            document.body.style.overflow = 'hidden';
        }

        function closeTimerModal() {
            timerModal.classList.remove('active');
            document.body.style.overflow = 'auto';
            pauseTimer();
        }

        function startTimer() {
            if (isTimerRunning) return;
            
            isTimerRunning = true;
            const startTime = Date.now() - (totalTimerSeconds - timerSeconds) * 1000;
            
            timerInterval = setInterval(() => {
                const elapsedSeconds = Math.floor((Date.now() - startTime) / 1000);
                timerSeconds = Math.max(totalTimerSeconds - elapsedSeconds, 0);
                
                updateTimerDisplay();
                
                if (timerSeconds <= 0) {
                    pauseTimer();
                    playTimerCompleteSound();
                    
                    if (Notification.permission === "granted") {
                        new Notification("Таймер завершен!", {
                            body: `Время для "${timerTitle.textContent}" истекло!`,
                            icon: "data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAyNCAyNCIgZmlsbD0iIzRGQ0U1MCI+PHBhdGggZD0iTTEyLDJBMTAuMDksMTAuMDksMCwwLDAsMiwxMi4xMiwxMC4xNiwxMC4xNiwwLDAsMCwxMS44NCwyMmwxLjI5LTEuMjZBLjU2LjU2LDAsMCwxLDEzLjgsMjBhOC4wOCw4LjA4LDAsMCwxLDguMjEtOC4yNCw4LjEzLDguMTMsMCwwLDEtOC4xMy04LjA2QTcuODgsNy44OCwwLDAsMSwxMy43LDZMMTMsNi44OGE2LjA5LDYuMDksMCwwLDAtNi4wNiw2LjIyLDYuMTIsNi4xMiwwLDAsMCw2LjI1LDYuMDgsNi4wOSw2LjA5LDAsMCwwLDUuNzktMy43N2guMTVhNC41LDQuNSwwLDAsMSw0LjA3LDUsNC41Nyw0LjU3LDAsMCwxLS4zNCwxLjc0TDIwLDE5Ljg4QTEwLDExLDAsMCwwLDIyLDEyLjIsMTAuNDYsMTAuNDYsMCwwLDAsMTIsMlptMCwxM2E0LDQsMCwwLDEtNC00LDQsNCwwLDAsMSw0LTQsNCw0LDAsMCwxLDQsNCw0LDQsMCwwLDEtNCw0WiIvPjwvc3ZnPg=="
                        });
                    }
                }
            }, 100);
        }

        function pauseTimer() {
            isTimerRunning = false;
            clearInterval(timerInterval);
        }

        function resetTimer() {
            pauseTimer();
            timerSeconds = totalTimerSeconds;
            updateTimerDisplay();
        }

        function updateTimerDisplay() {
            const minutes = Math.floor(timerSeconds / 60);
            const seconds = timerSeconds % 60;
            timerDisplay.textContent = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
            
            const progress = ((totalTimerSeconds - timerSeconds) / totalTimerSeconds) * 100;
            timerProgressBar.style.transform = `scaleX(${progress / 100})`;
            
            if (timerSeconds < 10 && timerSeconds > 0) {
                timerDisplay.style.color = '#ff4444';
            } else {
                timerDisplay.style.color = '';
            }
        }

        function playTimerCompleteSound() {
            try {
                const audioContext = new (window.AudioContext || window.webkitAudioContext)();
                
                const oscillator = audioContext.createOscillator();
                const gainNode = audioContext.createGain();
                
                oscillator.connect(gainNode);
                gainNode.connect(audioContext.destination);
                
                oscillator.frequency.setValueAtTime(800, audioContext.currentTime);
                oscillator.frequency.exponentialRampToValueAtTime(400, audioContext.currentTime + 0.5);
                
                oscillator.type = 'sine';
                
                gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.8);
                
                oscillator.start(audioContext.currentTime);
                oscillator.stop(audioContext.currentTime + 0.8);
                
                timerDisplay.style.color = '#ff4444';
                timerDisplay.classList.add('pulse');
                setTimeout(() => {
                    timerDisplay.style.color = '';
                    timerDisplay.classList.remove('pulse');
                }, 2000);
            } catch (e) {
                console.log("Аудио контекст не поддерживается");
            }
        }

        // Создание плавающих частиц
        function createParticles() {
            const container = document.getElementById('particles-container');
            const particleCount = 25;
            
            for (let i = 0; i < particleCount; i++) {
                const particle = document.createElement('div');
                particle.className = 'floating-particle';
                
                const size = Math.random() * 80 + 20;
                const colors = ['var(--primary-color)', 'var(--secondary-color)', 'var(--accent-color)', 'var(--cheese-color)', 'var(--sauce-color)'];
                const color = colors[i % colors.length];
                const left = Math.random() * 100;
                const top = Math.random() * 100;
                const duration = Math.random() * 20 + 10;
                const delay = Math.random() * 5;
                
                particle.style.width = `${size}px`;
                particle.style.height = `${size}px`;
                particle.style.background = `radial-gradient(circle, ${color} 0%, transparent 70%)`;
                particle.style.left = `${left}%`;
                particle.style.top = `${top}%`;
                particle.style.opacity = `${Math.random() * 0.08 + 0.02}`;
                particle.style.animationDuration = `${duration}s`;
                particle.style.animationDelay = `${delay}s`;
                
                container.appendChild(particle);
            }
        }

        // Анимация при загрузке
        function animateOnLoad() {
            const cards = document.querySelectorAll('.card');
            cards.forEach((card, index) => {
                card.style.animationDelay = `${0.2 + index * 0.2}s`;
            });
            
            const timerItems = document.querySelectorAll('.timer-item');
            timerItems.forEach((item, index) => {
                item.style.animation = `fadeInUp 0.8s ${0.5 + index * 0.1}s both`;
            });
            
            if ("Notification" in window && Notification.permission === "default") {
                setTimeout(() => {
                    if (confirm("Разрешить уведомления о завершении таймеров?")) {
                        Notification.requestPermission();
                    }
                }, 2000);
            }
        }

        // Вспомогательная функция для склонения существительных
        function pluralize(number, one, two, five) {
            let n = Math.abs(number);
            n %= 100;
            if (n >= 5 && n <= 20) {
                return five;
            }
            n %= 10;
            if (n === 1) {
                return one;
            }
            if (n >= 2 && n <= 4) {
                return two;
            }
            return five;
        }
    </script>
</body>
</html>
